version: "2"

networks:
  app-tier:
    driver: bridge

services:
  ws-app:
    image: 'mcr.microsoft.com/devcontainers/base:bookworm'
    volumes:
      # Forwards the local Docker socket to the container.
      - /var/run/docker.sock:/var/run/docker-host.sock 
      # Update this to wherever you want VS Code to mount the folder of your project
      - ../..:/workspaces:cached

    # Overrides default command so things don't shut down after the process ends.
    entrypoint: /usr/local/share/docker-init.sh
    command: sleep infinity 
    networks:
      - app-tier

  # https://github.com/bitnami/containers/tree/main/bitnami/postgresql
  airflow3:
    image: 'apache/airflow:3.1.0-python3.12'
    ports:
      - '8080:8080'
    command: standalone
    environment:
      - AIRFLOW__CORE__SIMPLE_AUTH_MANAGER_ALL_ADMINS=True
    volumes:
      - ../dags:/opt/airflow/dags # Mounts your local 'dags' folder to the container's '/opt/airflow/dags'
    networks:
      - app-tier

